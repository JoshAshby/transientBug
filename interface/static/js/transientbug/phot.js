// Generated by CoffeeScript 1.5.0
(function() {

  $(function() {
    var timeout, toggle;
    timeout = null;
    toggle = function(what) {
      var di, id;
      id = $(what).data("id");
      di = $("#" + id);
      return $.post("/admin/phots/" + id + "/toggle", function(data) {
        if (data[0]["success"]) {
          return window.location.reload();
        }
      });
    };
    $(document).on("click", ".confirm_btn", function() {
      return toggle(this);
    });
    $(document).on("click", ".nope_btn", function() {
      return $(".toggle_btn").popover('hide');
    });
    $(".toggle_btn").click(function(e) {
      var id;
      e.preventDefault();
      id = $(this);
      $(".toggle_btn").not(this).popover('hide');
      $(this).popover('show');
      $(".popover").find(".confirm_btn").data("id", $(this).data("id"));
      timeout = setTimeout(function() {
        return id.popover('hide');
      }, 3000);
      return $(document).on("mouseenter", ".popover", function() {
        return clearTimeout(timeout);
      }).on("mouseleave", ".popover", function() {
        return timeout = setTimeout(function() {
          return id.popover('hide');
        }, 3000);
      });
    }).popover({
      trigger: "manual",
      placement: "auto right",
      html: true,
      content: '<div class="btn-group"><button class="btn btn-success btn-sm confirm_btn"><i class="fa fa-check"></i></button><button class="btn btn-default btn-sm nope_btn"><i class="fa fa-times"></i></button></div>',
      container: "body"
    });
    $("#phot_tags").pillbox({
      url: "/phots/json/tags",
      name: "phot"
    });
    $("#phot_name").check_field({
      url: "/phots/json/names",
      reason: "That name is already in use."
    });
    $("#phot_name").done_typing({
      wait_interval: 1500,
      on_done: function() {
        return $("#phot_name").check_field("check");
      },
      on_empty: function() {
        return $("#phot_name").check_field("reset");
      }
    });
    return $("#new_phot").click(function(e) {
      var errors, input, _fn, _i, _len, _ref;
      errors = "";
      e.preventDefault();
      _ref = $(this).parents("form").find("input");
      _fn = function(input) {
        input = $(input);
        if (input.hasClass("has-error")) {
          return errors += "" + (input.attr("name")) + " needs to be changed. " + (input.data("reason")) + "<br>";
        }
      };
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        input = _ref[_i];
        _fn(input);
      }
      if (errors) {
        $(this).parents("form").prepend("<div class=\"alert alert-danger\"><b>Hold it.</b> Please fix these errors: <br>\n  " + errors + "\n</div>");
      }
      return {
        "else": $(this).parents("form").submit()
      };
    });
  });

}).call(this);
